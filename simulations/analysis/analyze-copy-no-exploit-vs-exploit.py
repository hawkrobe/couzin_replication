import pandas as pd
import numpy as np
from scipy import stats
import os, sys
import matplotlib.pyplot as plt
import pylab

sys.path.append("../utils/")
from utils import *

from parse import *

in_dir = '../../processed/'

others = []
states = []

for game in os.listdir(in_dir):
    if game[-4:] != '.csv':
        continue
    
    data = pd.io.parsers.read_csv(in_dir + game)
    players = set(data['pid'])
    n = len(players)
    if n != 5:
        continue
    for p in players:
        sub = data[data['pid'] == p]
        for j in list(sub.index):
            if sub['state'][j] != 'exploiting':
                others += [sub['other_exploiting'][j]]
                states += [sub['state'][j]]

df = pd.DataFrame(dict(other = others,
                       state = states))

states = df[df['other'] == False]['state']
mu1 = np.mean(states == 'copying')
sd1 = 2*np.std(states == 'copying')/np.sqrt(len(states))
states = df[df['other']]['state']
mu2 = np.mean(states == 'copying')
sd2 = 2*np.std(states == 'copying')/np.sqrt(len(states))

print 'nobody exploiting:', mu1, 'someone exploiting:', mu2
print 'sd1:', sd1, 'sd2:', sd2
